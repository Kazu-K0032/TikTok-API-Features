{% extends "base.html" %} {% block title %}動画アップロード{% endblock %} {%
block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/video-upload.css') }}"
/>
{% endblock %} {% block content %}
<div class="upload-container">
  <h1>動画アップロード</h1>

  <div class="upload-notice">
    <h3>⚠️ 重要な注意事項</h3>
    <p><strong>未監査アプリケーションの場合:</strong></p>
    <ul>
      <li>
        TikTokアカウントが<strong>プライベート設定</strong>である必要があります
      </li>
      <li>
        TikTokアプリで「設定」→「プライバシー」→「アカウント」を「プライベート」に設定してください
      </li>
      <li>投稿は「自分だけ」の設定でのみ可能です</li>
    </ul>
    <p><strong>投稿間隔について:</strong></p>
    <ul>
      <li>連続投稿は5分間の間隔が必要です</li>
      <li>短時間での連続投稿はTikTokのスパム対策により制限されます</li>
      <li>エラーが発生した場合は、数分間待ってから再度お試しください</li>
    </ul>
  </div>

  {% if account_status %}
  <div class="account-status">
    <h3>📊 アカウント状況</h3>
    {% if account_status.error %}
    <div class="status-error">
      <p>❌ {{ account_status.error }}</p>
    </div>
    {% else %}
    <div class="status-info">
      {% if account_status.is_private %}
      <p>✅ <strong>アカウントはプライベート設定です</strong></p>
      <p>投稿が可能です</p>
      {% else %}
      <p>❌ <strong>アカウントがプライベート設定ではありません</strong></p>
      <p>TikTokアプリでアカウントをプライベート設定に変更してください</p>
      {% endif %} {% if account_status.privacy_options %}
      <p><strong>利用可能なプライバシー設定:</strong></p>
      <ul>
        {% for option in account_status.privacy_options %}
        <li>{{ option }}</li>
        {% endfor %}
      </ul>

      <p><strong>判定基準:</strong></p>
      <ul>
        <li>
          ✅ プライベートアカウント:
          <code>FOLLOWER_OF_CREATOR</code
          >が含まれ、<code>PUBLIC_TO_EVERYONE</code>が含まれない
        </li>
        <li>
          ❌ パブリックアカウント: <code>PUBLIC_TO_EVERYONE</code>が含まれる
        </li>
      </ul>
      {% endif %}
    </div>
    {% endif %}
  </div>
  {% endif %}

  <div class="upload-card">
    <form id="upload-form" enctype="multipart/form-data">
      <div class="form-group">
        <label for="video-file">動画ファイル</label>
        <input
          type="file"
          id="video-file"
          name="video_file"
          accept="video/*"
          required
        />
        <div class="file-info" id="file-info" style="display: none">
          <p>ファイル名: <span id="file-name"></span></p>
          <p>サイズ: <span id="file-size"></span></p>
          <p>形式: <span id="file-type"></span></p>
        </div>
      </div>

      <div class="form-group">
        <label for="video-title">キャプション</label>
        <textarea
          id="video-title"
          name="title"
          placeholder="動画の説明を入力してください..."
          maxlength="2200"
          required
        ></textarea>
        <div class="char-count"><span id="char-count">0</span>/2200</div>
      </div>

      <div class="form-group">
        <label for="privacy-level">プライバシー設定 *</label>
        <select id="privacy-level" name="privacy_level" required>
          <option value="">プライバシー設定を選択してください</option>
          <option value="SELF_ONLY">自分だけ</option>
          <option value="MUTUAL_FOLLOW_FRIENDS">相互フォロー</option>
          <option value="PUBLIC_TO_EVERYONE">公開</option>
        </select>
        <div class="form-help">
          <p>
            <strong>注意:</strong>
            未監査のアプリケーションは「自分だけ」の設定でのみ投稿可能です。
          </p>
          <p>公開投稿を行うには、TikTokによる審査が必要です。</p>
        </div>
      </div>

      <div class="form-group">
        <label>投稿設定</label>
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              id="disable-comment"
              name="disable_comment"
            />
            <span class="checkmark"></span>
            コメントを無効にする
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="disable-duet" name="disable_duet" />
            <span class="checkmark"></span>
            デュエットを無効にする
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="disable-stitch" name="disable_stitch" />
            <span class="checkmark"></span>
            ステッチを無効にする
          </label>
        </div>
        <div class="form-help">
          <p>
            上記の設定は、デフォルトでは有効になっています。無効にしたい場合はチェックしてください。
          </p>
        </div>
      </div>

      <div class="form-group">
        <div class="consent-declaration">
          <label class="checkbox-label">
            <input
              type="checkbox"
              id="user-consent"
              name="user_consent"
              required
            />
            <span class="checkmark"></span>
            投稿することで、TikTokの音楽使用確認に同意します
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" id="upload-btn" class="btn btn-primary">
          <span class="btn-icon">📤</span>
          <span class="btn-text">直接投稿</span>
        </button>
        <button type="button" id="upload-draft-btn" class="btn btn-primary">
          <span class="btn-icon">📝</span>
          <span class="btn-text">下書き投稿</span>
        </button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
          <span class="btn-icon">←</span>
          <span class="btn-text">キャンセル</span>
        </a>
      </div>
    </form>
  </div>

  <!-- アップロード進捗 -->
  <div id="upload-progress" class="upload-progress" style="display: none">
    <div class="progress-header">
      <h3>アップロード中...</h3>
      <div class="progress-status" id="progress-status">初期化中...</div>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
    <div class="progress-text" id="progress-text">0%</div>
  </div>

  <!-- 結果表示 -->
  <div id="upload-result" class="upload-result" style="display: none">
    <div class="result-icon" id="result-icon">✅</div>
    <h3 id="result-title">アップロード完了</h3>
    <p id="result-message">動画のアップロードが完了しました。</p>
    <div class="result-actions">
      <a href="{{ url_for('dashboard') }}" class="btn btn-primary"
        >ダッシュボードに戻る</a
      >
      <button id="upload-another" class="btn btn-secondary">
        別の動画をアップロード
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/utils/globals.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/video-upload.js') }}"></script>
{% endblock %}
